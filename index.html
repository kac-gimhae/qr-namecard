<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¹€í•´ê³µí•­ ì§ì› QR ëª…í•¨ ìƒì„±ê¸°</title>
<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-33E0NMRKQ6"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-33E0NMRKQ6');
</script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #0B3D6B;
    --primary-light: #1565A0;
    --accent: #00A8E8;
    --bg: #F7F9FC;
    --card: #FFFFFF;
    --text: #1A2B3C;
    --text-secondary: #5A6B7C;
    --border: #E2E8F0;
    --error: #E53E3E;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    min-height: 100vh;
    padding: 24px 16px;
    background-image:
      radial-gradient(ellipse at 20% 50%, rgba(11,61,107,0.04) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 20%, rgba(0,168,232,0.04) 0%, transparent 50%);
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
  }

  /* Header */
  .page-header {
    text-align: center;
    margin-bottom: 32px;
  }
  .page-header h1 {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 6px;
  }
  .page-header p {
    font-size: 14px;
    color: var(--text-secondary);
  }

  /* Card */
  .card {
    background: var(--card);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 8px 24px rgba(11,61,107,0.06);
  }
  .card-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--primary);
  }

  /* Form */
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
  }
  .form-row.single {
    grid-template-columns: 1fr;
  }
  .form-row.triple {
    grid-template-columns: 1fr 1fr 1fr;
  }
  .form-group {
    display: flex;
    flex-direction: column;
  }
  .form-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 6px;
  }
  .form-label .required {
    color: var(--error);
    margin-left: 2px;
  }
  .form-control {
    padding: 10px 14px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    font-family: inherit;
    color: var(--text);
    background: #fff;
    transition: border-color 0.2s;
    outline: none;
  }
  .form-control:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,168,232,0.1);
  }
  .form-control:read-only {
    background: #F8FAFC;
    color: var(--text-secondary);
  }
  select.form-control {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235A6B7C' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 32px;
  }

  /* Custom input group for "ì§ì ‘ ì…ë ¥" */
  .custom-input-group {
    display: none;
    margin-top: 8px;
  }
  .custom-input-group.visible {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  /* Section divider inside card */
  .form-divider {
    border: none;
    border-top: 1px dashed var(--border);
    margin: 20px 0;
  }

  /* Buttons */
  .btn-generate {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    border: none;
    border-radius: 14px;
    font-size: 16px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 4px 15px rgba(11,61,107,0.3);
    letter-spacing: 0.5px;
  }
  .btn-generate:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(11,61,107,0.4);
  }
  .btn-generate:active { transform: translateY(0); }
  .btn-generate svg {
    width: 22px; height: 22px;
    fill: none; stroke: white;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
  }

  .btn-preview {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 14px;
    background: white;
    color: var(--primary);
    border: 1.5px solid var(--primary);
    border-radius: 14px;
    font-size: 15px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 12px;
  }
  .btn-preview:hover {
    background: rgba(11,61,107,0.04);
  }
  .btn-preview svg {
    width: 20px; height: 20px;
    fill: none; stroke: currentColor;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
  }

  /* QR Result */
  .qr-result { display: none; }
  .qr-result.visible { display: block; }
  .qr-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }
  .qr-item { text-align: center; }
  .qr-item h3 {
    font-size: 15px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 16px;
  }
  .qr-item canvas {
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    background: white;
  }
  .btn-download {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 14px;
    padding: 10px 20px;
    background: white;
    color: var(--primary);
    border: 1.5px solid var(--primary);
    border-radius: 10px;
    font-size: 13px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-download:hover {
    background: var(--primary);
    color: white;
  }
  .btn-download svg {
    width: 16px; height: 16px;
    fill: none; stroke: currentColor;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
  }

  /* ===== Phone Mockup Preview ===== */
  .preview-modal {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 200;
    overflow-y: auto;
    padding: 24px 16px;
    backdrop-filter: blur(4px);
  }
  .preview-modal.visible { display: flex; align-items: flex-start; justify-content: center; }
  .preview-modal-inner {
    background: var(--bg);
    border-radius: 20px;
    padding: 28px;
    max-width: 900px;
    width: 100%;
    position: relative;
    margin: 20px 0;
  }
  .preview-modal-close {
    position: absolute;
    top: 16px; right: 16px;
    width: 36px; height: 36px;
    border-radius: 50%;
    border: none;
    background: var(--border);
    color: var(--text);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }
  .preview-modal-close:hover { background: #CBD5E0; }
  .preview-modal h2 {
    font-size: 18px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 8px;
  }
  .preview-modal .subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 24px;
  }
  .phone-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }
  .phone-group h3 {
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 12px;
  }
  .phone-group h3 span {
    display: inline-block;
    padding: 3px 10px;
    background: var(--primary);
    color: white;
    border-radius: 6px;
    font-size: 11px;
    margin-right: 6px;
    vertical-align: middle;
  }

  /* Phone frame */
  .phone-frame {
    width: 260px;
    margin: 0 auto;
    border-radius: 28px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  }
  .phone-frame.ios { background: #F2F2F7; }
  .phone-frame.android { background: #FAFAFA; }

  /* iOS style */
  .ios .phone-statusbar {
    background: #F2F2F7;
    padding: 8px 20px 4px;
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    font-weight: 600;
    color: #1C1C1E;
  }
  .ios .phone-header {
    padding: 8px 16px 12px;
    text-align: center;
  }
  .ios .phone-header .nav-label {
    font-size: 11px;
    color: #007AFF;
  }
  .ios .phone-header h4 {
    font-size: 16px;
    font-weight: 700;
    color: #1C1C1E;
    margin-top: 4px;
  }
  .ios .contact-card {
    background: white;
    margin: 0 12px 12px;
    border-radius: 14px;
    overflow: hidden;
  }
  .ios .contact-avatar {
    width: 80px; height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #C7C7CC, #8E8E93);
    margin: 16px auto 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    color: white;
    font-weight: 300;
  }
  .ios .contact-name {
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    color: #1C1C1E;
    padding: 0 16px 4px;
  }
  .ios .contact-org {
    text-align: center;
    font-size: 12px;
    color: #8E8E93;
    padding: 0 16px 12px;
  }
  .ios .contact-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 8px 16px 16px;
  }
  .ios .contact-action {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    font-size: 10px;
    color: #007AFF;
  }
  .ios .contact-action .icon-circle {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: #F2F2F7;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }
  .ios .contact-fields {
    background: white;
    margin: 0 12px 12px;
    border-radius: 14px;
    overflow: hidden;
  }
  .ios .contact-field {
    padding: 10px 16px;
    border-bottom: 0.5px solid #E5E5EA;
  }
  .ios .contact-field:last-child { border-bottom: none; }
  .ios .contact-field .field-label {
    font-size: 11px;
    color: #8E8E93;
    margin-bottom: 2px;
  }
  .ios .contact-field .field-value {
    font-size: 14px;
    color: #007AFF;
  }
  .ios .contact-field .field-value.black {
    color: #1C1C1E;
  }

  /* Android style */
  .android .phone-statusbar {
    background: white;
    padding: 8px 16px 4px;
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    color: #444;
  }
  .android .phone-header {
    background: white;
    padding: 8px 16px 12px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .android .phone-header .back-arrow {
    font-size: 18px;
    color: #444;
  }
  .android .phone-header h4 {
    font-size: 15px;
    font-weight: 500;
    color: #202124;
  }
  .android .contact-hero {
    background: white;
    text-align: center;
    padding: 16px 16px 20px;
    border-bottom: 1px solid #E8EAED;
  }
  .android .contact-avatar {
    width: 72px; height: 72px;
    border-radius: 50%;
    background: linear-gradient(135deg, #8AB4F8, #4285F4);
    margin: 0 auto 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    color: white;
    font-weight: 400;
  }
  .android .contact-name {
    font-size: 20px;
    font-weight: 400;
    color: #202124;
    margin-bottom: 2px;
  }
  .android .contact-org {
    font-size: 13px;
    color: #5F6368;
  }
  .android .contact-actions {
    display: flex;
    justify-content: center;
    gap: 32px;
    padding: 16px;
    background: white;
    border-bottom: 1px solid #E8EAED;
  }
  .android .contact-action {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    color: #1A73E8;
  }
  .android .contact-action .icon-circle {
    width: 40px; height: 40px;
    border-radius: 50%;
    background: #E8F0FE;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: #1A73E8;
  }
  .android .contact-fields {
    background: white;
  }
  .android .contact-field {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 14px 16px;
    border-bottom: 1px solid #F1F3F4;
  }
  .android .contact-field:last-child { border-bottom: none; }
  .android .contact-field .field-icon {
    font-size: 18px;
    color: #5F6368;
    margin-top: 2px;
    width: 24px;
    text-align: center;
  }
  .android .contact-field .field-value {
    font-size: 14px;
    color: #202124;
  }
  .android .contact-field .field-label {
    font-size: 12px;
    color: #5F6368;
    margin-top: 1px;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--text);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 500;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.22,1,0.36,1);
    z-index: 300;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
  }
  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  /* Responsive */
  @media (max-width: 600px) {
    .form-row, .form-row.triple {
      grid-template-columns: 1fr;
    }
    .qr-grid {
      grid-template-columns: 1fr;
    }
    .custom-input-group.visible {
      grid-template-columns: 1fr;
    }
    .phone-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<div class="container">

  <!-- Header -->
  <div class="page-header">
    <h1>ê¹€í•´ê³µí•­ ì§ì› QR ëª…í•¨ ìƒì„±ê¸°</h1>
    <p>ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ í•œêµ­ì–´Â·ì˜ì–´ QR ëª…í•¨ì„ ë°”ë¡œ ìƒì„±í•©ë‹ˆë‹¤</p>
  </div>

  <!-- ì‚¬ìš©ë°©ë²• ë³´ê¸° ë²„íŠ¼ -->
  <div style="text-align:center; margin-bottom:16px;">
    <a href="tutorial.html" style="display:inline-block; background:#0B3D6B; color:#fff; text-decoration:none; padding:10px 28px; border-radius:50px; font-size:0.95rem; font-weight:700; box-shadow:0 2px 8px rgba(11,61,107,0.3); transition:transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(11,61,107,0.4)';" onmouseout="this.style.transform='';this.style.boxShadow='0 2px 8px rgba(11,61,107,0.3)';">
      ğŸ“– ì‚¬ìš©ë°©ë²• ë³´ê¸°
    </a>
  </div>

  <!-- ì¸ì ì‚¬í•­ ì…ë ¥ (ì—°ë½ì²˜ í¬í•¨) -->
  <div class="card">
    <h2 class="card-title">ì¸ì ì‚¬í•­</h2>

    <div class="form-row triple">
      <div class="form-group">
        <label class="form-label">ì´ë¦„ (í•œê¸€)<span class="required">*</span></label>
        <input type="text" id="nameKo" class="form-control" placeholder="ì˜ˆ) í™ê¸¸ë™">
      </div>
      <div class="form-group">
        <label class="form-label">ì˜ë¬¸ ì„±<span class="required">*</span></label>
        <input type="text" id="nameEnLast" class="form-control" placeholder="ì˜ˆ) HONG">
      </div>
      <div class="form-group">
        <label class="form-label">ì˜ë¬¸ ì´ë¦„<span class="required">*</span></label>
        <input type="text" id="nameEnFirst" class="form-control" placeholder="ì˜ˆ) Gildong">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ì†Œì† (í•œê¸€)</label>
        <input type="text" id="orgKo" class="form-control" value="í•œêµ­ê³µí•­ê³µì‚¬ ê¹€í•´ê³µí•­">
      </div>
      <div class="form-group">
        <label class="form-label">ì†Œì† (ì˜ë¬¸)</label>
        <input type="text" id="orgEn" class="form-control" value="Gimhae International Airport, Korea Airports Corporation">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ë¶€ì„œ<span class="required">*</span></label>
        <select id="deptSelect" class="form-control">
          <option value="">-- ë¶€ì„œ ì„ íƒ --</option>
          <option value="ê³µí•­ìš´ì˜ì„¼í„°">ê³µí•­ìš´ì˜ì„¼í„°</option>
          <option value="ìš´ì˜ë‹¨">ìš´ì˜ë‹¨</option>
          <option value="ì´ê´„ê¸°íšë¶€">ì´ê´„ê¸°íšë¶€</option>
          <option value="ì¬ë¬´ê´€ë¦¬ë¶€">ì¬ë¬´ê´€ë¦¬ë¶€</option>
          <option value="ìš´ì˜ê³„íšë¶€">ìš´ì˜ê³„íšë¶€</option>
          <option value="ê³ ê°ì„œë¹„ìŠ¤ë¶€">ê³ ê°ì„œë¹„ìŠ¤ë¶€</option>
          <option value="ë³´ì•ˆê´€ë¦¬ë¶€">ë³´ì•ˆê´€ë¦¬ë¶€</option>
          <option value="ì‹œì„¤ë‹¨">ì‹œì„¤ë‹¨</option>
          <option value="ASìš´ì˜ë¶€">ASìš´ì˜ë¶€</option>
          <option value="í† ëª©ë¶€">í† ëª©ë¶€</option>
          <option value="ê±´ì¶•ì‹œì„¤ë¶€">ê±´ì¶•ì‹œì„¤ë¶€</option>
          <option value="ê¸°ê³„ì‹œì„¤ë¶€">ê¸°ê³„ì‹œì„¤ë¶€</option>
          <option value="ì „ë ¥ì‹œì„¤ë¶€">ì „ë ¥ì‹œì„¤ë¶€</option>
          <option value="í•­í–‰ì „ìë¶€">í•­í–‰ì „ìë¶€</option>
          <option value="í•­í–‰í†µì‹ ë¶€">í•­í–‰í†µì‹ ë¶€</option>
          <option value="__custom__">ì§ì ‘ ì…ë ¥</option>
          <option value="__none__">ì„ íƒ ì•ˆí•¨ (ê³µí•­ì¥ ì „ìš©)</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">ë¶€ì„œ (ì˜ë¬¸)</label>
        <input type="text" id="deptEn" class="form-control" placeholder="ë¶€ì„œ ì„ íƒ ì‹œ ìë™ ì…ë ¥" readonly>
      </div>
    </div>

    <!-- ì§ì ‘ ì…ë ¥ ì˜ì—­ -->
    <div class="custom-input-group" id="customDeptGroup">
      <div class="form-group">
        <label class="form-label">ë¶€ì„œëª… ì§ì ‘ ì…ë ¥ (í•œê¸€)<span class="required">*</span></label>
        <input type="text" id="deptCustomKo" class="form-control" placeholder="ë¶€ì„œëª… ì…ë ¥">
      </div>
      <div class="form-group">
        <label class="form-label">ë¶€ì„œëª… ì§ì ‘ ì…ë ¥ (ì˜ë¬¸)<span class="required">*</span></label>
        <input type="text" id="deptCustomEn" class="form-control" placeholder="Department name">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ì§ìœ„<span class="required">*</span></label>
        <select id="titleSelect" class="form-control">
          <option value="">-- ì§ìœ„ ì„ íƒ --</option>
          <option value="ê³µí•­ì¥">ê³µí•­ì¥</option>
          <option value="ë‹¨ì¥">ë‹¨ì¥</option>
          <option value="ë¶€ì¥">ë¶€ì¥</option>
          <option value="ì„¼í„°ì¥">ì„¼í„°ì¥</option>
          <option value="ì°¨ì¥">ì°¨ì¥</option>
          <option value="ê³¼ì¥">ê³¼ì¥</option>
          <option value="ëŒ€ë¦¬">ëŒ€ë¦¬</option>
          <option value="__custom__">ì§ì ‘ ì…ë ¥</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">ì§ìœ„ (ì˜ë¬¸)</label>
        <input type="text" id="titleEn" class="form-control" placeholder="ì§ìœ„ ì„ íƒ ì‹œ ìë™ ì…ë ¥" readonly>
      </div>
    </div>

    <!-- ì§ì ‘ ì…ë ¥ ì˜ì—­ (ì§ìœ„) -->
    <div class="custom-input-group" id="customTitleGroup">
      <div class="form-group">
        <label class="form-label">ì§ìœ„ ì§ì ‘ ì…ë ¥ (í•œê¸€)<span class="required">*</span></label>
        <input type="text" id="titleCustomKo" class="form-control" placeholder="ì§ìœ„ ì…ë ¥">
      </div>
      <div class="form-group">
        <label class="form-label">ì§ìœ„ ì§ì ‘ ì…ë ¥ (ì˜ë¬¸)<span class="required">*</span></label>
        <input type="text" id="titleCustomEn" class="form-control" placeholder="Title in English">
      </div>
    </div>

    <hr class="form-divider">

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">íœ´ëŒ€í° <small style="font-weight:normal;color:#888;font-size:11px;">íœ´ëŒ€í° ë…¸ì¶œì„ ì›ì¹˜ ì•Šìœ¼ì‹¤ ê²½ìš°, ì§ì¥ë²ˆí˜¸ë§Œ ì…ë ¥í•˜ì„¸ìš”</small></label>
        <input type="text" id="cell" class="form-control" placeholder="ì˜ˆ) 00000000000">
      </div>
      <div class="form-group">
        <label class="form-label">ì§ì¥ì „í™”<span class="required">*</span> <small style="font-weight:normal;color:#888;font-size:11px;">ë‚´ì„ ë²ˆí˜¸ ë’·ìë¦¬ 4ê°œë§Œ ì…ë ¥í•˜ì„¸ìš”</small></label>
        <div style="display:flex; align-items:center; gap:0;">
          <span style="background:#e9ecef; border:1px solid #ccc; border-right:none; padding:8px 8px; border-radius:6px 0 0 6px; font-size:0.85rem; color:#555; white-space:nowrap;">051-974-</span>
          <input type="text" id="workExt" class="form-control" placeholder="0000" maxlength="4" style="border-radius:0 6px 6px 0; flex:1;">
        </div>
      </div>
    </div>

    <div class="form-row single">
      <div class="form-group">
        <label class="form-label">ì´ë©”ì¼<span class="required">*</span></label>
        <div style="display:flex; align-items:center; gap:0;">
          <input type="text" id="emailId" class="form-control" placeholder="ì˜ˆ) abcd1234" style="border-radius:6px 0 0 6px; flex:1;">
          <span style="background:#e9ecef; border:1px solid #ccc; border-left:none; padding:8px 6px; border-radius:0 6px 6px 0; font-size:0.78rem; color:#555; white-space:nowrap;">@airport.co.kr</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ìƒëŒ€ë°© QR ì´¬ì˜ ì‹œ ì˜ˆì‹œ ë²„íŠ¼ -->
  <button type="button" class="btn-preview" id="btnPreviewExample" onclick="openPreviewModal()">
    <svg viewBox="0 0 24 24"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>
    ìƒëŒ€ë°© QR ì´¬ì˜ ì‹œ ì˜ˆì‹œ
  </button>

  <!-- ìƒì„± ë²„íŠ¼ -->
  <button type="button" class="btn-generate" id="btnGenerate" onclick="generateQR()">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><path d="M14 14h3v3h-3zM20 14h1v1h-1zM14 20h1v1h-1zM17 17h3v3h-3z"/></svg>
    QR ì½”ë“œ ìƒì„±
  </button>

  <!-- QR ê²°ê³¼ -->
  <div class="card qr-result" id="qrResult">
    <h2 class="card-title">QR ëª…í•¨</h2>
    <div class="qr-grid">
      <div class="qr-item">
        <h3>í•œêµ­ì–´ ëª…í•¨</h3>
        <canvas id="qrKorean" style="cursor:pointer;" onclick="downloadVcf('kr')"></canvas>
        <button type="button" class="btn-download" onclick="downloadQR('qrKorean', 'ko')">
          <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        </button>
      </div>
      <div class="qr-item">
        <h3>English Namecard</h3>
        <canvas id="qrEnglish" style="cursor:pointer;" onclick="downloadVcf('en')"></canvas>
        <button type="button" class="btn-download" onclick="downloadQR('qrEnglish', 'en')">
          <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Download Image
        </button>
      </div>
    </div>
  </div>

</div>

<!-- ===== QR ì´¬ì˜ ì˜ˆì‹œ ëª¨ë‹¬ ===== -->
<div class="preview-modal" id="previewModal">
  <div class="preview-modal-inner">
    <button class="preview-modal-close" onclick="closePreviewModal()">&times;</button>
    <h2>ìƒëŒ€ë°© QR ì´¬ì˜ ì‹œ ì˜ˆì‹œ</h2>
    <p class="subtitle">ìƒëŒ€ë°©ì´ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì—°ë½ì²˜ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>

    <div class="phone-grid">

      <!-- iOS í•œêµ­ì–´ -->
      <div class="phone-group">
        <h3><span>iOS</span> í•œêµ­ì–´ ëª…í•¨</h3>
        <div class="phone-frame ios">
          <div class="phone-statusbar">
            <span>9:41</span>
            <span>&#9679;&#9679;&#9679;</span>
          </div>
          <div class="phone-header">
            <div class="nav-label">&lt; ì¹´ë©”ë¼</div>
            <h4>ìƒˆë¡œìš´ ì—°ë½ì²˜</h4>
          </div>
          <div class="contact-card">
            <div class="contact-avatar" id="iosKoAvatar">í™</div>
            <div class="contact-name" id="iosKoName">í™ê¸¸ë™</div>
            <div class="contact-org" id="iosKoOrg">í•œêµ­ê³µí•­ê³µì‚¬ ê¹€í•´ê³µí•­</div>
            <div class="contact-actions">
              <div class="contact-action"><div class="icon-circle">&#9743;</div>ì „í™”</div>
              <div class="contact-action"><div class="icon-circle">&#9993;</div>ë©”ì‹œì§€</div>
              <div class="contact-action"><div class="icon-circle">&#9993;</div>ë©”ì¼</div>
            </div>
          </div>
          <div class="contact-fields">
            <div class="contact-field" id="iosKoCellRow">
              <div class="field-label">íœ´ëŒ€ì „í™”</div>
              <div class="field-value" id="iosKoCell">+82-10-0000-0000</div>
            </div>
            <div class="contact-field">
              <div class="field-label">ì§ì¥</div>
              <div class="field-value" id="iosKoWork">+82-51-974-0000</div>
            </div>
            <div class="contact-field">
              <div class="field-label">ì§ì¥</div>
              <div class="field-value" id="iosKoEmail">abcd1234@airport.co.kr</div>
            </div>
            <div class="contact-field">
              <div class="field-label">íšŒì‚¬</div>
              <div class="field-value black" id="iosKoDept">í•œêµ­ê³µí•­ê³µì‚¬ ê¹€í•´ê³µí•­ ì´ê´„ê¸°íšë¶€</div>
            </div>
            <div class="contact-field">
              <div class="field-label">ì§ìœ„</div>
              <div class="field-value black" id="iosKoTitle">ê³¼ì¥</div>
            </div>
          </div>
        </div>
      </div>

      <!-- iOS ì˜ì–´ -->
      <div class="phone-group">
        <h3><span>iOS</span> English Namecard</h3>
        <div class="phone-frame ios">
          <div class="phone-statusbar">
            <span>9:41</span>
            <span>&#9679;&#9679;&#9679;</span>
          </div>
          <div class="phone-header">
            <div class="nav-label">&lt; Camera</div>
            <h4>New Contact</h4>
          </div>
          <div class="contact-card">
            <div class="contact-avatar" id="iosEnAvatar">H</div>
            <div class="contact-name" id="iosEnName">Gildong HONG</div>
            <div class="contact-org" id="iosEnOrg">KAC Gimhae Airport</div>
            <div class="contact-actions">
              <div class="contact-action"><div class="icon-circle">&#9743;</div>Call</div>
              <div class="contact-action"><div class="icon-circle">&#9993;</div>Message</div>
              <div class="contact-action"><div class="icon-circle">&#9993;</div>Mail</div>
            </div>
          </div>
          <div class="contact-fields">
            <div class="contact-field" id="iosEnCellRow">
              <div class="field-label">mobile</div>
              <div class="field-value" id="iosEnCell">+82-10-0000-0000</div>
            </div>
            <div class="contact-field">
              <div class="field-label">work</div>
              <div class="field-value" id="iosEnWork">+82-51-974-0000</div>
            </div>
            <div class="contact-field">
              <div class="field-label">work</div>
              <div class="field-value" id="iosEnEmail">abcd1234@airport.co.kr</div>
            </div>
            <div class="contact-field">
              <div class="field-label">company</div>
              <div class="field-value black" id="iosEnDept">Gimhae Intl. Airport, KAC</div>
            </div>
            <div class="contact-field">
              <div class="field-label">title</div>
              <div class="field-value black" id="iosEnTitle">Manager</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Android í•œêµ­ì–´ -->
      <div class="phone-group">
        <h3><span>Android</span> í•œêµ­ì–´ ëª…í•¨</h3>
        <div class="phone-frame android">
          <div class="phone-statusbar">
            <span>9:41</span>
            <span>&#9679; &#9679; &#9679;</span>
          </div>
          <div class="phone-header">
            <div class="back-arrow">&#8592;</div>
            <h4>ì—°ë½ì²˜ ì €ì¥</h4>
          </div>
          <div class="contact-hero">
            <div class="contact-avatar" id="aosKoAvatar">í™</div>
            <div class="contact-name" id="aosKoName">í™ê¸¸ë™</div>
            <div class="contact-org" id="aosKoOrg">í•œêµ­ê³µí•­ê³µì‚¬ ê¹€í•´ê³µí•­ Â· ê³¼ì¥</div>
          </div>
          <div class="contact-actions">
            <div class="contact-action"><div class="icon-circle">&#9743;</div>ì „í™”</div>
            <div class="contact-action"><div class="icon-circle">&#9993;</div>ë¬¸ì</div>
            <div class="contact-action"><div class="icon-circle">@</div>ì´ë©”ì¼</div>
          </div>
          <div class="contact-fields">
            <div class="contact-field" id="aosKoCellRow">
              <div class="field-icon">&#9743;</div>
              <div>
                <div class="field-value" id="aosKoCell">+82-10-0000-0000</div>
                <div class="field-label">íœ´ëŒ€ì „í™”</div>
              </div>
            </div>
            <div class="contact-field">
              <div class="field-icon">&#9743;</div>
              <div>
                <div class="field-value" id="aosKoWork">+82-51-974-0000</div>
                <div class="field-label">ì§ì¥</div>
              </div>
            </div>
            <div class="contact-field">
              <div class="field-icon">@</div>
              <div>
                <div class="field-value" id="aosKoEmail">abcd1234@airport.co.kr</div>
                <div class="field-label">ì§ì¥</div>
              </div>
            </div>
            <div class="contact-field">
              <div class="field-icon">&#127970;</div>
              <div>
                <div class="field-value" id="aosKoDept">í•œêµ­ê³µí•­ê³µì‚¬ ê¹€í•´ê³µí•­ ì´ê´„ê¸°íšë¶€</div>
                <div class="field-label">íšŒì‚¬</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Android ì˜ì–´ -->
      <div class="phone-group">
        <h3><span>Android</span> English Namecard</h3>
        <div class="phone-frame android">
          <div class="phone-statusbar">
            <span>9:41</span>
            <span>&#9679; &#9679; &#9679;</span>
          </div>
          <div class="phone-header">
            <div class="back-arrow">&#8592;</div>
            <h4>Save contact</h4>
          </div>
          <div class="contact-hero">
            <div class="contact-avatar" id="aosEnAvatar">H</div>
            <div class="contact-name" id="aosEnName">Gildong HONG</div>
            <div class="contact-org" id="aosEnOrg">KAC Gimhae Airport Â· Manager</div>
          </div>
          <div class="contact-actions">
            <div class="contact-action"><div class="icon-circle">&#9743;</div>Call</div>
            <div class="contact-action"><div class="icon-circle">&#9993;</div>Text</div>
            <div class="contact-action"><div class="icon-circle">@</div>Email</div>
          </div>
          <div class="contact-fields">
            <div class="contact-field" id="aosEnCellRow">
              <div class="field-icon">&#9743;</div>
              <div>
                <div class="field-value" id="aosEnCell">+82-10-0000-0000</div>
                <div class="field-label">Mobile</div>
              </div>
            </div>
            <div class="contact-field">
              <div class="field-icon">&#9743;</div>
              <div>
                <div class="field-value" id="aosEnWork">+82-51-974-0000</div>
                <div class="field-label">Work</div>
              </div>
            </div>
            <div class="contact-field">
              <div class="field-icon">@</div>
              <div>
                <div class="field-value" id="aosEnEmail">abcd1234@airport.co.kr</div>
                <div class="field-label">Work</div>
              </div>
            </div>
            <div class="contact-field">
              <div class="field-icon">&#127970;</div>
              <div>
                <div class="field-value" id="aosEnDept">Gimhae Intl. Airport, KAC</div>
                <div class="field-label">Company</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /.phone-grid -->
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
// === ì „ì—­ vCard ì €ì¥ ===
var lastVcardKr = '';
var lastVcardEn = '';

// === ë°ì´í„° ===
const DEPARTMENTS = {
  'ê³µí•­ìš´ì˜ì„¼í„°': 'Airport Operations Control Center',
  'ìš´ì˜ë‹¨': 'Landside Operations Office',
  'ì´ê´„ê¸°íšë¶€': 'General Administration Dept.',
  'ì¬ë¬´ê´€ë¦¬ë¶€': 'Financial Management Dept.',
  'ìš´ì˜ê³„íšë¶€': 'Terminal Operations & Planning Dept.',
  'ê³ ê°ì„œë¹„ìŠ¤ë¶€': 'Customer Service Dept.',
  'ë³´ì•ˆê´€ë¦¬ë¶€': 'Security Control Dept.',
  'ì‹œì„¤ë‹¨': 'Airside Operations Office',
  'ASìš´ì˜ë¶€': 'Airside Operations Dept.',
  'í† ëª©ë¶€': 'Civil Engineering Dept.',
  'ê±´ì¶•ì‹œì„¤ë¶€': 'Construction & Facilities Management Dept.',
  'ê¸°ê³„ì‹œì„¤ë¶€': 'Mechanical Systems Dept.',
  'ì „ë ¥ì‹œì„¤ë¶€': 'Electrical Facilities Dept.',
  'í•­í–‰ì „ìë¶€': 'Air Navigation Electronics Dept.',
  'í•­í–‰í†µì‹ ë¶€': 'Air Navigation Communications Dept.'
};

const TITLES = {
  'ê³µí•­ì¥': 'Chief Officer of Airport',
  'ë‹¨ì¥': 'Director',
  'ë¶€ì¥': 'General Manager',
  'ì„¼í„°ì¥': 'Head',
  'ì°¨ì¥': 'Deputy General Manager',
  'ê³¼ì¥': 'Manager',
  'ëŒ€ë¦¬': 'Assistant Manager'
};

// === ë¶€ì„œ ë“œë¡­ë‹¤ìš´ ì—°ë™ ===
document.getElementById('deptSelect').addEventListener('change', function() {
  const val = this.value;
  const deptEnInput = document.getElementById('deptEn');
  const customGroup = document.getElementById('customDeptGroup');

  if (val === '__custom__') {
    customGroup.classList.add('visible');
    deptEnInput.value = '';
    deptEnInput.readOnly = true;
  } else if (val === '__none__') {
    customGroup.classList.remove('visible');
    deptEnInput.value = '';
    deptEnInput.readOnly = true;
  } else if (val && DEPARTMENTS[val]) {
    customGroup.classList.remove('visible');
    deptEnInput.value = DEPARTMENTS[val];
    deptEnInput.readOnly = true;
  } else {
    customGroup.classList.remove('visible');
    deptEnInput.value = '';
    deptEnInput.readOnly = true;
  }
});

// === ì§ìœ„ ë“œë¡­ë‹¤ìš´ ì—°ë™ ===
document.getElementById('titleSelect').addEventListener('change', function() {
  const val = this.value;
  const titleEnInput = document.getElementById('titleEn');
  const customGroup = document.getElementById('customTitleGroup');

  if (val === '__custom__') {
    customGroup.classList.add('visible');
    titleEnInput.value = '';
    titleEnInput.readOnly = true;
  } else if (val && TITLES[val]) {
    customGroup.classList.remove('visible');
    titleEnInput.value = TITLES[val];
    titleEnInput.readOnly = true;
  } else {
    customGroup.classList.remove('visible');
    titleEnInput.value = '';
    titleEnInput.readOnly = true;
  }
});

// === ì „í™”ë²ˆí˜¸ í¬ë§· ===
function formatPhone(raw) {
  let digits = raw.replace(/[^0-9]/g, '');
  if (digits.startsWith('0')) {
    return '+82-' + digits.substring(1).replace(/(\d{1,2})(\d{3,4})(\d{4})/, '$1-$2-$3');
  }
  if (raw.startsWith('+')) return raw;
  return raw;
}

// === ìœ íš¨ì„± ê²€ì‚¬ ===
function validate() {
  const fields = [
    { id: 'nameKo', label: 'ì´ë¦„ (í•œê¸€)' },
    { id: 'nameEnLast', label: 'ì˜ë¬¸ ì„±' },
    { id: 'nameEnFirst', label: 'ì˜ë¬¸ ì´ë¦„' },
    { id: 'workExt', label: 'ë‚´ì„ ë²ˆí˜¸' },
    { id: 'emailId', label: 'ì´ë©”ì¼ ID' }
  ];

  for (const f of fields) {
    if (!document.getElementById(f.id).value.trim()) {
      showToast(f.label + 'ì„(ë¥¼) ì…ë ¥í•´ì£¼ì„¸ìš”.');
      document.getElementById(f.id).focus();
      return false;
    }
  }

  const deptVal = document.getElementById('deptSelect').value;
  if (!deptVal) {
    showToast('ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    document.getElementById('deptSelect').focus();
    return false;
  }
  if (deptVal === '__none__') {
    // ì„ íƒ ì•ˆí•¨ (ê³µí•­ì¥ ì „ìš©) - ë¶€ì„œ ê²€ì¦ ê±´ë„ˆëœ€
  } else if (deptVal === '__custom__') {
    if (!document.getElementById('deptCustomKo').value.trim()) {
      showToast('ë¶€ì„œëª… (í•œê¸€)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      document.getElementById('deptCustomKo').focus();
      return false;
    }
    if (!document.getElementById('deptCustomEn').value.trim()) {
      showToast('ë¶€ì„œëª… (ì˜ë¬¸)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      document.getElementById('deptCustomEn').focus();
      return false;
    }
  }

  const titleVal = document.getElementById('titleSelect').value;
  if (!titleVal) {
    showToast('ì§ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    document.getElementById('titleSelect').focus();
    return false;
  }
  if (titleVal === '__custom__') {
    if (!document.getElementById('titleCustomKo').value.trim()) {
      showToast('ì§ìœ„ (í•œê¸€)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      document.getElementById('titleCustomKo').focus();
      return false;
    }
    if (!document.getElementById('titleCustomEn').value.trim()) {
      showToast('ì§ìœ„ (ì˜ë¬¸)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      document.getElementById('titleCustomEn').focus();
      return false;
    }
  }

  return true;
}

// === QR ìƒì„± ===
function generateQR() {
  if (!validate()) return;
  // GA4 ì´ë²¤íŠ¸: QR ìƒì„±
  if (typeof gtag === 'function') { gtag('event', 'qr_generated', { event_category: 'engagement' }); }

  const nameKo = document.getElementById('nameKo').value.trim();
  const nameEnFirst = document.getElementById('nameEnFirst').value.trim();
  const nameEnLast = document.getElementById('nameEnLast').value.trim();
  const orgKo = document.getElementById('orgKo').value.trim();
  const orgEn = document.getElementById('orgEn').value.trim();

  const deptVal = document.getElementById('deptSelect').value;
  let deptKo, deptEn;
  if (deptVal === '__none__') {
    deptKo = '';
    deptEn = '';
  } else if (deptVal === '__custom__') {
    deptKo = document.getElementById('deptCustomKo').value.trim();
    deptEn = document.getElementById('deptCustomEn').value.trim();
  } else {
    deptKo = deptVal;
    deptEn = document.getElementById('deptEn').value.trim();
  }

  const titleSelectVal = document.getElementById('titleSelect').value;
  let titleKo, titleEn;
  if (titleSelectVal === '__custom__') {
    titleKo = document.getElementById('titleCustomKo').value.trim();
    titleEn = document.getElementById('titleCustomEn').value.trim();
  } else {
    titleKo = titleSelectVal;
    titleEn = document.getElementById('titleEn').value.trim();
  }

  const cell = formatPhone(document.getElementById('cell').value.trim());
  const work = formatPhone('051974' + document.getElementById('workExt').value.trim());
  const emailRaw = document.getElementById('emailId').value.trim().replace(/@airport\.co\.kr$/i, '');
  const email = emailRaw + '@airport.co.kr';

  const orgLineKo = deptKo ? 'ORG:' + orgKo + ';' + deptKo : 'ORG:' + orgKo;
  const orgLineEn = deptEn ? 'ORG:' + orgEn + ';' + deptEn : 'ORG:' + orgEn;

  const vcardKr = [
    'BEGIN:VCARD',
    'VERSION:3.0',
    'N:' + nameKo + ';;;;',
    'FN:\uD55C\uAD6D\uACF5\uD56D\uACF5\uC0AC(\uAE40\uD574\uACF5\uD56D) ' + nameKo + ' ' + titleKo,
    orgLineKo,
    'TITLE:' + titleKo,
    cell ? 'TEL;TYPE=CELL:' + cell : '',
    'TEL;TYPE=WORK:' + work,
    'EMAIL;TYPE=WORK:' + email,
    'END:VCARD'
  ].filter(Boolean).join('\n');

  const vcardEn = [
    'BEGIN:VCARD',
    'VERSION:3.0',
    'N:' + nameEnLast + ';' + nameEnFirst + ';;;',
    'FN:' + nameEnFirst + ' ' + nameEnLast + ' (KAC Gimhae Airport)',
    orgLineEn,
    'TITLE:' + titleEn,
    cell ? 'TEL;TYPE=CELL:' + cell : '',
    'TEL;TYPE=WORK:' + work,
    'EMAIL;TYPE=WORK:' + email,
    'END:VCARD'
  ].filter(Boolean).join('\n');

  const qrOptions = {
    errorCorrectionLevel: 'M',
    width: 280,
    margin: 2,
    color: {
      dark: '#0B3D6B',
      light: '#FFFFFF'
    }
  };

  // ì „ì—­ì— ì €ì¥ (í´ë¦­ ì‹œ .vcf ë‹¤ìš´ë¡œë“œìš©)
  lastVcardKr = vcardKr;
  lastVcardEn = vcardEn;

  const canvasKo = document.getElementById('qrKorean');
  const canvasEn = document.getElementById('qrEnglish');

  QRCode.toCanvas(canvasKo, vcardKr, qrOptions, function(err) {
    if (err) {
      showToast('\uD55C\uAD6D\uC5B4 QR \uC0DD\uC131 \uC2E4\uD328: ' + err.message);
      return;
    }
  });

  QRCode.toCanvas(canvasEn, vcardEn, qrOptions, function(err) {
    if (err) {
      showToast('\uC601\uC5B4 QR \uC0DD\uC131 \uC2E4\uD328: ' + err.message);
      return;
    }
  });

  var resultEl = document.getElementById('qrResult');
  resultEl.classList.add('visible');
  setTimeout(function() {
    resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);

  showToast('QR \uCF54\uB4DC\uAC00 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4!');
}

// === ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ===
// === vCard íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì—°ë½ì²˜ ë“±ë¡) ===
function downloadVcf(lang) {
  var vcard = lang === 'kr' ? lastVcardKr : lastVcardEn;
  if (!vcard) { showToast('ë¨¼ì € QRì½”ë“œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.'); return; }
  var nameKo = document.getElementById('nameKo').value.trim();
  var nameEnLast = document.getElementById('nameEnLast').value.trim();
  var suffix = lang === 'kr' ? 'í•œêµ­ì–´' : 'English';
  var filename = 'ëª…í•¨_' + suffix + '_' + (nameEnLast || '') + (nameKo || '') + '.vcf';
  var blob = new Blob([vcard], { type: 'text/vcard;charset=utf-8' });
  var url = URL.createObjectURL(blob);
  var link = document.createElement('a');
  link.href = url;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
}

function downloadQR(canvasId, lang) {
  var canvas = document.getElementById(canvasId);
  var nameKo = document.getElementById('nameKo').value.trim();
  var nameEnLast = document.getElementById('nameEnLast').value.trim();

  var prefix = nameEnLast + nameKo;
  var suffix = lang === 'ko' ? 'Korean' : 'English';
  var filename = 'QR_' + suffix + '_' + prefix + '.png';

  var link = document.createElement('a');
  link.download = filename;
  link.href = canvas.toDataURL('image/png');
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);

  showToast(filename + ' \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC');
}

// === ì˜ˆì‹œ ëª¨ë‹¬ ===
function openPreviewModal() {
  // í˜„ì¬ í¼ ê°’ìœ¼ë¡œ ëª©ì—… ì—…ë°ì´íŠ¸
  var nameKo = document.getElementById('nameKo').value.trim() || '\uD64D\uAE38\uB3D9';
  var nameEnFirst = document.getElementById('nameEnFirst').value.trim() || 'Gildong';
  var nameEnLast = document.getElementById('nameEnLast').value.trim() || 'HONG';
  var orgKo = document.getElementById('orgKo').value.trim();
  var orgEn = document.getElementById('orgEn').value.trim();

  var deptVal = document.getElementById('deptSelect').value;
  var deptKo, deptEn;
  if (deptVal === '__none__') {
    deptKo = '';
    deptEn = '';
  } else if (deptVal === '__custom__') {
    deptKo = document.getElementById('deptCustomKo').value.trim() || '\uCD1D\uAD04\uAE30\uD68D\uBD80';
    deptEn = document.getElementById('deptCustomEn').value.trim() || 'General Administration Dept.';
  } else if (deptVal && DEPARTMENTS[deptVal]) {
    deptKo = deptVal;
    deptEn = DEPARTMENTS[deptVal];
  } else {
    deptKo = '\uCD1D\uAD04\uAE30\uD68D\uBD80';
    deptEn = 'General Administration Dept.';
  }

  var titleSelectVal = document.getElementById('titleSelect').value;
  var titleKo, titleEn;
  if (titleSelectVal === '__custom__') {
    titleKo = document.getElementById('titleCustomKo').value.trim() || '\uACFC\uC7A5';
    titleEn = document.getElementById('titleCustomEn').value.trim() || 'Manager';
  } else {
    titleKo = titleSelectVal || '\uACFC\uC7A5';
    titleEn = document.getElementById('titleEn').value.trim() || 'Manager';
  }

  var cellRaw = document.getElementById('cell').value.trim();
  var workRaw = '051974' + (document.getElementById('workExt').value.trim() || '0000');
  var emailId = (document.getElementById('emailId').value.trim() || 'abcd1234').replace(/@airport\.co\.kr$/i, '');
  var emailVal = emailId + '@airport.co.kr';

  var hasCell = cellRaw.length > 0;
  var cellFmt = hasCell ? formatPhone(cellRaw) : '';
  var workFmt = formatPhone(workRaw);
  var enName = nameEnFirst + ' ' + nameEnLast;
  var koInitial = nameKo.charAt(0);
  var enInitial = nameEnLast.charAt(0).toUpperCase();

  // iOS í•œêµ­ì–´
  document.getElementById('iosKoAvatar').textContent = koInitial;
  document.getElementById('iosKoName').textContent = nameKo;
  document.getElementById('iosKoOrg').textContent = orgKo;
  document.getElementById('iosKoCellRow').style.display = hasCell ? '' : 'none';
  document.getElementById('iosKoCell').textContent = cellFmt;
  document.getElementById('iosKoWork').textContent = workFmt;
  document.getElementById('iosKoEmail').textContent = emailVal;
  document.getElementById('iosKoDept').textContent = deptKo ? orgKo + ' ' + deptKo : orgKo;
  document.getElementById('iosKoTitle').textContent = titleKo;

  // iOS ì˜ì–´
  document.getElementById('iosEnAvatar').textContent = enInitial;
  document.getElementById('iosEnName').textContent = enName;
  document.getElementById('iosEnOrg').textContent = 'KAC Gimhae Airport';
  document.getElementById('iosEnCellRow').style.display = hasCell ? '' : 'none';
  document.getElementById('iosEnCell').textContent = cellFmt;
  document.getElementById('iosEnWork').textContent = workFmt;
  document.getElementById('iosEnEmail').textContent = emailVal;
  document.getElementById('iosEnDept').textContent = deptEn || orgEn;
  document.getElementById('iosEnTitle').textContent = titleEn;

  // Android í•œêµ­ì–´
  document.getElementById('aosKoAvatar').textContent = koInitial;
  document.getElementById('aosKoName').textContent = nameKo;
  document.getElementById('aosKoOrg').textContent = orgKo + ' \u00B7 ' + titleKo;
  document.getElementById('aosKoCellRow').style.display = hasCell ? '' : 'none';
  document.getElementById('aosKoCell').textContent = cellFmt;
  document.getElementById('aosKoWork').textContent = workFmt;
  document.getElementById('aosKoEmail').textContent = emailVal;
  document.getElementById('aosKoDept').textContent = deptKo ? orgKo + ' ' + deptKo : orgKo;

  // Android ì˜ì–´
  document.getElementById('aosEnAvatar').textContent = enInitial;
  document.getElementById('aosEnName').textContent = enName;
  document.getElementById('aosEnOrg').textContent = 'KAC Gimhae Airport \u00B7 ' + titleEn;
  document.getElementById('aosEnCellRow').style.display = hasCell ? '' : 'none';
  document.getElementById('aosEnCell').textContent = cellFmt;
  document.getElementById('aosEnWork').textContent = workFmt;
  document.getElementById('aosEnEmail').textContent = emailVal;
  document.getElementById('aosEnDept').textContent = deptEn || orgEn;

  document.getElementById('previewModal').classList.add('visible');
  document.body.style.overflow = 'hidden';
}

function closePreviewModal() {
  document.getElementById('previewModal').classList.remove('visible');
  document.body.style.overflow = '';
}

// ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
document.getElementById('previewModal').addEventListener('click', function(e) {
  if (e.target === this) closePreviewModal();
});

// ESC í‚¤ë¡œ ë‹«ê¸°
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closePreviewModal();
});

// === í† ìŠ¤íŠ¸ ì•Œë¦¼ ===
function showToast(msg) {
  var toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(function() {
    toast.classList.remove('show');
  }, 2500);
}
</script>
</body>
</html>
