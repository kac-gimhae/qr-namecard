<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>김해공항 직원 QR 명함 생성기</title>
<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-33E0NMRKQ6"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-33E0NMRKQ6');
</script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #0B3D6B;
    --primary-light: #1565A0;
    --accent: #00A8E8;
    --bg: #F7F9FC;
    --card: #FFFFFF;
    --text: #1A2B3C;
    --text-secondary: #5A6B7C;
    --border: #E2E8F0;
    --error: #E53E3E;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    min-height: 100vh;
    padding: 24px 16px;
    background-image:
      radial-gradient(ellipse at 20% 50%, rgba(11,61,107,0.04) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 20%, rgba(0,168,232,0.04) 0%, transparent 50%);
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
  }

  /* Header */
  .page-header {
    text-align: center;
    margin-bottom: 32px;
  }
  .page-header h1 {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 6px;
  }
  .page-header p {
    font-size: 14px;
    color: var(--text-secondary);
  }

  /* Card */
  .card {
    background: var(--card);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 8px 24px rgba(11,61,107,0.06);
  }
  .card-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--primary);
  }

  /* Form */
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 16px;
  }
  .form-row.single {
    grid-template-columns: 1fr;
  }
  .form-row.triple {
    grid-template-columns: 1fr 1fr 1fr;
  }
  .form-group {
    display: flex;
    flex-direction: column;
  }
  .form-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 6px;
  }
  .form-label .required {
    color: var(--error);
    margin-left: 2px;
  }
  .form-control {
    padding: 10px 14px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    font-family: inherit;
    color: var(--text);
    background: #fff;
    transition: border-color 0.2s;
    outline: none;
  }
  .form-control:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,168,232,0.1);
  }
  .form-control:read-only {
    background: #F8FAFC;
    color: var(--text-secondary);
  }
  select.form-control {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235A6B7C' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 32px;
  }

  /* Custom input group for "직접 입력" */
  .custom-input-group {
    display: none;
    margin-top: 8px;
  }
  .custom-input-group.visible {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  /* Section divider inside card */
  .form-divider {
    border: none;
    border-top: 1px dashed var(--border);
    margin: 20px 0;
  }

  /* Buttons */
  .btn-generate {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    border: none;
    border-radius: 14px;
    font-size: 16px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 4px 15px rgba(11,61,107,0.3);
    letter-spacing: 0.5px;
  }
  .btn-generate:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(11,61,107,0.4);
  }
  .btn-generate:active { transform: translateY(0); }
  .btn-generate svg {
    width: 22px; height: 22px;
    fill: none; stroke: white;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
  }


  /* Toast */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--text);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 500;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.22,1,0.36,1);
    z-index: 300;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
  }
  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  /* Responsive */
  @media (max-width: 600px) {
    .form-row, .form-row.triple {
      grid-template-columns: 1fr;
    }
    .qr-grid {
      grid-template-columns: 1fr;
    }
    .custom-input-group.visible {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<div class="container">

  <!-- Header -->
  <div class="page-header">
    <h1>김해공항 직원 QR 명함 생성기</h1>
    <p>정보를 입력하면 한국어·영어 QR 명함을 바로 생성합니다</p>
  </div>

  <!-- 인적사항 입력 (연락처 포함) -->
  <div class="card">
    <h2 class="card-title">인적사항</h2>

    <div class="form-row triple">
      <div class="form-group">
        <label class="form-label">이름 (한글)<span class="required">*</span></label>
        <input type="text" id="nameKo" class="form-control" placeholder="예) 홍길동">
      </div>
      <div class="form-group">
        <label class="form-label">영문 성<span class="required">*</span></label>
        <input type="text" id="nameEnLast" class="form-control" placeholder="예) HONG">
      </div>
      <div class="form-group">
        <label class="form-label">영문 이름<span class="required">*</span></label>
        <input type="text" id="nameEnFirst" class="form-control" placeholder="예) Gildong">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">소속 (한글)</label>
        <input type="text" id="orgKo" class="form-control" value="한국공항공사 김해공항">
      </div>
      <div class="form-group">
        <label class="form-label">소속 (영문)</label>
        <input type="text" id="orgEn" class="form-control" value="Gimhae International Airport, Korea Airports Corporation">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">부서<span class="required">*</span></label>
        <select id="deptSelect" class="form-control">
          <option value="">-- 부서 선택 --</option>
          <option value="공항운영센터">공항운영센터</option>
          <option value="운영단">운영단</option>
          <option value="총괄기획부">총괄기획부</option>
          <option value="재무관리부">재무관리부</option>
          <option value="운영계획부">운영계획부</option>
          <option value="고객서비스부">고객서비스부</option>
          <option value="보안관리부">보안관리부</option>
          <option value="시설단">시설단</option>
          <option value="AS운영부">AS운영부</option>
          <option value="토목부">토목부</option>
          <option value="건축시설부">건축시설부</option>
          <option value="기계시설부">기계시설부</option>
          <option value="전력시설부">전력시설부</option>
          <option value="항행전자부">항행전자부</option>
          <option value="항행통신부">항행통신부</option>
          <option value="__custom__">직접 입력</option>
          <option value="__none__">선택 안함 (공항장 전용)</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">부서 (영문)</label>
        <input type="text" id="deptEn" class="form-control" placeholder="부서 선택 시 자동 입력" readonly>
      </div>
    </div>

    <!-- 직접 입력 영역 -->
    <div class="custom-input-group" id="customDeptGroup">
      <div class="form-group">
        <label class="form-label">부서명 직접 입력 (한글)<span class="required">*</span></label>
        <input type="text" id="deptCustomKo" class="form-control" placeholder="부서명 입력">
      </div>
      <div class="form-group">
        <label class="form-label">부서명 직접 입력 (영문)<span class="required">*</span></label>
        <input type="text" id="deptCustomEn" class="form-control" placeholder="Department name">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">직위<span class="required">*</span></label>
        <select id="titleSelect" class="form-control">
          <option value="">-- 직위 선택 --</option>
          <option value="공항장">공항장</option>
          <option value="단장">단장</option>
          <option value="부장">부장</option>
          <option value="센터장">센터장</option>
          <option value="차장">차장</option>
          <option value="과장">과장</option>
          <option value="대리">대리</option>
          <option value="__custom__">직접 입력</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">직위 (영문)</label>
        <input type="text" id="titleEn" class="form-control" placeholder="직위 선택 시 자동 입력" readonly>
      </div>
    </div>

    <!-- 직접 입력 영역 (직위) -->
    <div class="custom-input-group" id="customTitleGroup">
      <div class="form-group">
        <label class="form-label">직위 직접 입력 (한글)<span class="required">*</span></label>
        <input type="text" id="titleCustomKo" class="form-control" placeholder="직위 입력">
      </div>
      <div class="form-group">
        <label class="form-label">직위 직접 입력 (영문)<span class="required">*</span></label>
        <input type="text" id="titleCustomEn" class="form-control" placeholder="Title in English">
      </div>
    </div>

    <hr class="form-divider">

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">휴대폰 <small style="font-weight:normal;color:#888;font-size:11px;">휴대폰 노출을 원치 않으실 경우, 직장번호만 입력하세요</small></label>
        <input type="text" id="cell" class="form-control" placeholder="예) 00000000000">
      </div>
      <div class="form-group">
        <label class="form-label">직장전화<span class="required">*</span> <small style="font-weight:normal;color:#888;font-size:11px;">내선번호 뒷자리 4개만 입력하세요</small></label>
        <div style="display:flex; align-items:center; gap:0;">
          <span style="background:#e9ecef; border:1px solid #ccc; border-right:none; padding:8px 8px; border-radius:6px 0 0 6px; font-size:0.85rem; color:#555; white-space:nowrap;">051-974-</span>
          <input type="text" id="workExt" class="form-control" placeholder="0000" maxlength="4" style="border-radius:0 6px 6px 0; flex:1;">
        </div>
      </div>
    </div>

    <div class="form-row single">
      <div class="form-group">
        <label class="form-label">이메일<span class="required">*</span></label>
        <div style="display:flex; align-items:center; gap:0;">
          <input type="text" id="emailId" class="form-control" placeholder="예) abcd1234" style="border-radius:6px 0 0 6px; flex:1;">
          <span style="background:#e9ecef; border:1px solid #ccc; border-left:none; padding:8px 6px; border-radius:0 6px 6px 0; font-size:0.78rem; color:#555; white-space:nowrap;">@airport.co.kr</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 생성 버튼 -->
  <button type="button" class="btn-generate" id="btnGenerate" onclick="generateQR()">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><path d="M14 14h3v3h-3zM20 14h1v1h-1zM14 20h1v1h-1zM17 17h3v3h-3z"/></svg>
    QR 코드 생성
  </button>

  <!-- QR 결과 -->
  <div class="card qr-result" id="qrResult">
    <h2 class="card-title">QR 명함</h2>
    <div class="qr-grid">
      <div class="qr-item">
        <h3>디지털 명함 QR</h3>
        <canvas id="qrNamecard" style="cursor:pointer;" onclick="openNamecard()"></canvas>
        <div style="margin:12px 0 8px; line-height:1.6;">
          <div style="font-size:1rem; font-weight:700; color:#0B3D6B;">QR 명함이 생성되었습니다</div>
          <div style="font-size:0.82rem; color:#666; margin-top:4px;">이 QR 이미지를 휴대전화에 저장해두고,<br>명함 교환 시 상대방에게 보여주세요.</div>
        </div>
        <button type="button" class="btn-download" onclick="downloadQR('qrNamecard')">
          <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          QR 이미지 다운로드
        </button>
      </div>
    </div>
  </div>

</div>


<div class="toast" id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
// === 전역 URL 저장 ===
var lastNamecardUrl = '';

// === 데이터 ===
const DEPARTMENTS = {
  '공항운영센터': 'Airport Operations Control Center',
  '운영단': 'Landside Operations Office',
  '총괄기획부': 'General Administration Dept.',
  '재무관리부': 'Financial Management Dept.',
  '운영계획부': 'Terminal Operations & Planning Dept.',
  '고객서비스부': 'Customer Service Dept.',
  '보안관리부': 'Security Control Dept.',
  '시설단': 'Airside Operations Office',
  'AS운영부': 'Airside Operations Dept.',
  '토목부': 'Civil Engineering Dept.',
  '건축시설부': 'Construction & Facilities Management Dept.',
  '기계시설부': 'Mechanical Systems Dept.',
  '전력시설부': 'Electrical Facilities Dept.',
  '항행전자부': 'Air Navigation Electronics Dept.',
  '항행통신부': 'Air Navigation Communications Dept.'
};

const TITLES = {
  '공항장': 'Chief Officer of Airport',
  '단장': 'Director',
  '부장': 'General Manager',
  '센터장': 'Head',
  '차장': 'Deputy General Manager',
  '과장': 'Manager',
  '대리': 'Assistant Manager'
};

// === 부서 드롭다운 연동 ===
document.getElementById('deptSelect').addEventListener('change', function() {
  const val = this.value;
  const deptEnInput = document.getElementById('deptEn');
  const customGroup = document.getElementById('customDeptGroup');

  if (val === '__custom__') {
    customGroup.classList.add('visible');
    deptEnInput.value = '';
    deptEnInput.readOnly = true;
  } else if (val === '__none__') {
    customGroup.classList.remove('visible');
    deptEnInput.value = '';
    deptEnInput.readOnly = true;
  } else if (val && DEPARTMENTS[val]) {
    customGroup.classList.remove('visible');
    deptEnInput.value = DEPARTMENTS[val];
    deptEnInput.readOnly = true;
  } else {
    customGroup.classList.remove('visible');
    deptEnInput.value = '';
    deptEnInput.readOnly = true;
  }
});

// === 직위 드롭다운 연동 ===
document.getElementById('titleSelect').addEventListener('change', function() {
  const val = this.value;
  const titleEnInput = document.getElementById('titleEn');
  const customGroup = document.getElementById('customTitleGroup');

  if (val === '__custom__') {
    customGroup.classList.add('visible');
    titleEnInput.value = '';
    titleEnInput.readOnly = true;
  } else if (val && TITLES[val]) {
    customGroup.classList.remove('visible');
    titleEnInput.value = TITLES[val];
    titleEnInput.readOnly = true;
  } else {
    customGroup.classList.remove('visible');
    titleEnInput.value = '';
    titleEnInput.readOnly = true;
  }
});

// === 전화번호 포맷 ===
function formatPhone(raw) {
  let digits = raw.replace(/[^0-9]/g, '');
  if (digits.startsWith('0')) {
    return '+82-' + digits.substring(1).replace(/(\d{1,2})(\d{3,4})(\d{4})/, '$1-$2-$3');
  }
  if (raw.startsWith('+')) return raw;
  return raw;
}

// === 유효성 검사 ===
function validate() {
  const fields = [
    { id: 'nameKo', label: '이름 (한글)' },
    { id: 'nameEnLast', label: '영문 성' },
    { id: 'nameEnFirst', label: '영문 이름' },
    { id: 'workExt', label: '내선번호' },
    { id: 'emailId', label: '이메일 ID' }
  ];

  for (const f of fields) {
    if (!document.getElementById(f.id).value.trim()) {
      showToast(f.label + '을(를) 입력해주세요.');
      document.getElementById(f.id).focus();
      return false;
    }
  }

  const deptVal = document.getElementById('deptSelect').value;
  if (!deptVal) {
    showToast('부서를 선택해주세요.');
    document.getElementById('deptSelect').focus();
    return false;
  }
  if (deptVal === '__none__') {
    // 선택 안함 (공항장 전용) - 부서 검증 건너뜀
  } else if (deptVal === '__custom__') {
    if (!document.getElementById('deptCustomKo').value.trim()) {
      showToast('부서명 (한글)을 입력해주세요.');
      document.getElementById('deptCustomKo').focus();
      return false;
    }
    if (!document.getElementById('deptCustomEn').value.trim()) {
      showToast('부서명 (영문)을 입력해주세요.');
      document.getElementById('deptCustomEn').focus();
      return false;
    }
  }

  const titleVal = document.getElementById('titleSelect').value;
  if (!titleVal) {
    showToast('직위를 선택해주세요.');
    document.getElementById('titleSelect').focus();
    return false;
  }
  if (titleVal === '__custom__') {
    if (!document.getElementById('titleCustomKo').value.trim()) {
      showToast('직위 (한글)을 입력해주세요.');
      document.getElementById('titleCustomKo').focus();
      return false;
    }
    if (!document.getElementById('titleCustomEn').value.trim()) {
      showToast('직위 (영문)을 입력해주세요.');
      document.getElementById('titleCustomEn').focus();
      return false;
    }
  }

  return true;
}

// === QR 생성 ===
function generateQR() {
  if (!validate()) return;
  // GA4 이벤트: QR 생성
  if (typeof gtag === 'function') { gtag('event', 'qr_generated', { event_category: 'engagement' }); }

  const nameKo = document.getElementById('nameKo').value.trim();
  const nameEnFirst = document.getElementById('nameEnFirst').value.trim();
  const nameEnLast = document.getElementById('nameEnLast').value.trim();

  const deptVal = document.getElementById('deptSelect').value;
  let deptKo = '', deptEn = '';
  if (deptVal === '__none__') {
    deptKo = '';
    deptEn = '';
  } else if (deptVal === '__custom__') {
    deptKo = document.getElementById('deptCustomKo').value.trim();
    deptEn = document.getElementById('deptCustomEn').value.trim();
  } else {
    deptKo = deptVal;
    deptEn = document.getElementById('deptEn').value.trim();
  }

  const titleSelectVal = document.getElementById('titleSelect').value;
  let titleKo, titleEn;
  if (titleSelectVal === '__custom__') {
    titleKo = document.getElementById('titleCustomKo').value.trim();
    titleEn = document.getElementById('titleCustomEn').value.trim();
  } else {
    titleKo = titleSelectVal;
    titleEn = document.getElementById('titleEn').value.trim();
  }

  const cellRaw = document.getElementById('cell').value.trim();
  const workExt = document.getElementById('workExt').value.trim();
  const emailId = document.getElementById('emailId').value.trim().replace(/@airport\.co\.kr$/i, '');

  // URL 파라미터 조합
  const params = new URLSearchParams();
  params.set('n', nameKo);
  params.set('ef', nameEnFirst);
  params.set('el', nameEnLast);
  if (deptKo) params.set('d', deptKo);
  if (deptEn) params.set('de', deptEn);
  params.set('t', titleKo);
  params.set('te', titleEn);
  if (cellRaw) params.set('c', cellRaw);
  params.set('w', workExt);
  params.set('e', emailId);

  const namecardUrl = 'https://kac-gimhae.github.io/qr-namecard/digital_namecard.html?' + params.toString();

  const qrOptions = {
    errorCorrectionLevel: 'M',
    width: 280,
    margin: 2,
    color: {
      dark: '#0B3D6B',
      light: '#FFFFFF'
    }
  };

  // 전역에 저장 (클릭 시 명함 페이지 열기용)
  lastNamecardUrl = namecardUrl;

  const canvas = document.getElementById('qrNamecard');

  QRCode.toCanvas(canvas, namecardUrl, qrOptions, function(err) {
    if (err) {
      showToast('QR \uC0DD\uC131 \uC2E4\uD328: ' + err.message);
      return;
    }
  });

  var resultEl = document.getElementById('qrResult');
  resultEl.classList.add('visible');
  setTimeout(function() {
    resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);

  showToast('QR \uCF54\uB4DC\uAC00 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4!');
}

// === 디지털 명함 페이지 열기 ===
function openNamecard() {
  if (!lastNamecardUrl) { showToast('먼저 QR코드를 생성해주세요.'); return; }
  window.open(lastNamecardUrl, '_blank');
}

// === QR 이미지 다운로드 ===
function downloadQR(canvasId) {
  var canvas = document.getElementById(canvasId);
  var nameKo = document.getElementById('nameKo').value.trim();
  var nameEnLast = document.getElementById('nameEnLast').value.trim();
  var filename = 'QR_' + nameEnLast + nameKo + '.png';

  var link = document.createElement('a');
  link.download = filename;
  link.href = canvas.toDataURL('image/png');
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);

  showToast(filename + ' \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC');
}


// === 토스트 알림 ===
function showToast(msg) {
  var toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(function() {
    toast.classList.remove('show');
  }, 2500);
}
</script>
</body>
</html>
